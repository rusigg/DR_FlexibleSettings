<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Входящий ЮЗД - универсальный передаточный документ</Value>
		<Value xsi:type="xs:string"> // Для получения ссылки документа
 Приемник.Записать();

 // Поиск контрагента
 Если НЕ ЗначениеЗаполнено(Приемник.Контрагент) Тогда

     НайденныйКонтрагент = Неопределено;

     ИНН = "";
     КПП = "";
     Идентификатор = "";  
     СтруктураДокумента.Свойство("ИдОтпр"     , Идентификатор);      
     СтруктураДокумента.Свойство("ПродавецИНН", ИНН);
     СтруктураДокумента.Свойство("ПродавецКПП", КПП);      
     Если ЗначениеЗаполнено(ИНН) Тогда
         Запрос = Новый Запрос;
         Запрос.Текст = 
         "ВЫБРАТЬ
         |    Контрагенты.Ссылка КАК Ссылка
         |ИЗ
         |    Справочник.Контрагенты КАК Контрагенты
         |ГДЕ
         |    Контрагенты.ИНН = &amp;ИНН
         |    И ВЫБОР
         |            КОГДА &amp;КПП = НЕОПРЕДЕЛЕНО
         |                    ИЛИ &amp;КПП = """"
         |                    ИЛИ &amp;КПП ЕСТЬ NULL
         |                ТОГДА ИСТИНА
         |            ИНАЧЕ Контрагенты.КПП = &amp;КПП
         |        КОНЕЦ";                    
         Запрос.УстановитьПараметр("ИНН", ИНН);
         Запрос.УстановитьПараметр("КПП", КПП);

         РезультатЗапроса = Запрос.Выполнить();
         Если НЕ РезультатЗапроса.Пустой() Тогда
             ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
             Если ВыборкаДетальныеЗаписи.Количество() = 1 Тогда
                 ВыборкаДетальныеЗаписи.Следующий();
                 НайденныйКонтрагент = ВыборкаДетальныеЗаписи.Ссылка;
             КонецЕсли;
         КонецЕсли;                                                    
     КонецЕсли;

     Если ЗначениеЗаполнено(НайденныйКонтрагент)  Тогда                                                 
         Запрос = Новый Запрос;
         Запрос.Текст = 
         "ВЫБРАТЬ
         |    ЭКОМ_ОператорыЭДО.Ссылка КАК Ссылка
         |ИЗ
         |    Справочник.ЭКОМ_ОператорыЭДО КАК ЭКОМ_ОператорыЭДО
         |ГДЕ
         |    ЭКОМ_ОператорыЭДО.Идентификатор = &amp;Идентификатор";      
         Запрос.УстановитьПараметр("Идентификатор", Лев(Идентификатор, 3));

         Оператор = Неопределено;
         РезультатЗапроса = Запрос.Выполнить();
         Если НЕ РезультатЗапроса.Пустой() Тогда
             ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
             ВыборкаДетальныеЗаписи.Следующий();
             Оператор = ВыборкаДетальныеЗаписи.Ссылка;
         КонецЕсли;      
         Если ЗначениеЗаполнено(Оператор) Тогда              
             Приемник.Контрагент = НайденныйКонтрагент;              
             // Запишем в регистр GLN
             МенеджерЗаписи = РегистрыСведений.ЭКОМ_GLN.СоздатьМенеджерЗаписи();
             МенеджерЗаписи.Объект = НайденныйКонтрагент;    
             МенеджерЗаписи.Прочитать();  
             Если НЕ МенеджерЗаписи.Выбран() Тогда // Если запись не существует то записать    
                 МенеджерЗаписи.Объект  = НайденныйКонтрагент;
                 МенеджерЗаписи.Ид_ОЭД  = Сред(Идентификатор, 4);
                 МенеджерЗаписи.Партнер = Оператор;
                 МенеджерЗаписи.Записать();
             КонецЕсли;              
         КонецЕсли;      
     КонецЕсли;      
 КонецЕсли;

 ТекстУточнения = "";       
 НайденоПоступление = Ложь;
 НайденаСчетФактура = Ложь;
 ДокПН      = Неопределено;
 ДокСчФ     = Неопределено;
 КоррПН     = Неопределено;
 КоррСЧФ    = Неопределено;
 
 ПредставлениеДокКоррПоступления1С = "";
 ПредставлениеДокКоррСчФ1С = "";
 ПредставлениеДокПоступления1С = "";
 ПредставлениеДокСчФ1С = "";
 ПредставлениеПН  = "Поступление из ЮЗД № " + СокрЛП(Приемник.НакладнаяНомер) + " от " + Формат(Приемник.НакладнаяДата, "ДФ=dd.MM.yyyy");
 ПредставлениеСЧФ = "Счет-фактура из ЮЗД № " + СокрЛП(Приемник.СЧФНомер) + " от " + Формат(Приемник.СЧФДата, "ДФ=dd.MM.yyyy");

 ЭКОМДокОснование = Неопределено;
 СтруктураДокумента.Свойство("ЭКОМДокОснование", ЭКОМДокОснование);
	 
 Если Приемник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPR_01_Входящий
	 ИЛИ Приемник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Входящий 
	 ИЛИ Приемник.ВидДокумента = Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Входящий Тогда
	 
	 // Ищем поступление
	 Запрос = Новый Запрос;
	 Запрос.Текст = 
	 "ВЫБРАТЬ
	 |	ВЫБОР
	 |		КОГДА НЕ ПоступлениеПоНомеруДатеНакладной.Ссылка ЕСТЬ NULL
	 |			ТОГДА ПоступлениеПоНомеруДатеНакладной.Ссылка
	 |		КОГДА НЕ ПоступлениеПоЗаказу.Ссылка ЕСТЬ NULL
	 |			ТОГДА ПоступлениеПоЗаказу.Ссылка
	 |		КОГДА НЕ ПоступлениеПоНомеруДатеДокумента.Ссылка ЕСТЬ NULL
	 |			ТОГДА ПоступлениеПоНомеруДатеДокумента.Ссылка
	 |		КОГДА НЕ ПоступлениеПоНомеруДатеСЧФ.Ссылка ЕСТЬ NULL
	 |			ТОГДА ПоступлениеПоНомеруДатеСЧФ.Ссылка
	 |		ИНАЧЕ НЕОПРЕДЕЛЕНО
	 |	КОНЕЦ КАК ПН,
	 |	СчетФактураПоНомеруСЧФ.Ссылка КАК СЧФ
	 |ПОМЕСТИТЬ ВТ
	 |ИЗ
	 |	Документ.ЭКОМ_Документы КАК ЭКОМ_ДокументыЮЗД
	 |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПоступлениеПоНомеруДатеНакладной
	 |		ПО (НЕ ПоступлениеПоНомеруДатеНакладной.ПометкаУдаления)
	 |			И (ПоступлениеПоНомеруДатеНакладной.Дата МЕЖДУ ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.НакладнаяДата, ДЕНЬ, -3) И ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.НакладнаяДата, ДЕНЬ, 3))
	 |			И ЭКОМ_ДокументыЮЗД.Контрагент = ПоступлениеПоНомеруДатеНакладной.Контрагент
	 |			И (ПоступлениеПоНомеруДатеНакладной.Организация = ЭКОМ_ДокументыЮЗД.Организация)
	 |			И (ПоступлениеПоНомеруДатеНакладной.Проведен)
	 |			И (ПОДСТРОКА(ПоступлениеПоНомеруДатеНакладной.НомерВходящегоДокумента, 1, 100) = ЭКОМ_ДокументыЮЗД.НакладнаяНомер)
	 |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПоступлениеПоНомеруДатеДокумента
	 |		ПО (НЕ ПоступлениеПоНомеруДатеДокумента.ПометкаУдаления)
	 |			И (ПоступлениеПоНомеруДатеДокумента.Дата МЕЖДУ ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.НакладнаяДата, ДЕНЬ, -3) И ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.НакладнаяДата, ДЕНЬ, 3))
	 |			И ЭКОМ_ДокументыЮЗД.Контрагент = ПоступлениеПоНомеруДатеДокумента.Контрагент
	 |			И (ПоступлениеПоНомеруДатеДокумента.Организация = ЭКОМ_ДокументыЮЗД.Организация)
	 |			И (ПОДСТРОКА(ПоступлениеПоНомеруДатеДокумента.Номер, 1, 100) = ЭКОМ_ДокументыЮЗД.НакладнаяНомер)
	 |			И (ПоступлениеПоНомеруДатеДокумента.Проведен)
	 |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПоступлениеПоНомеруДатеСЧФ
	 |		ПО (НЕ ПоступлениеПоНомеруДатеСЧФ.ПометкаУдаления)
	 |			И (ПоступлениеПоНомеруДатеСЧФ.Дата МЕЖДУ ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.СЧФДата, ДЕНЬ, -3) И ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.СЧФДата, ДЕНЬ, 3))
	 |			И ЭКОМ_ДокументыЮЗД.Контрагент = ПоступлениеПоНомеруДатеСЧФ.Контрагент
	 |			И (ПоступлениеПоНомеруДатеСЧФ.Организация = ЭКОМ_ДокументыЮЗД.Организация)
	 |			И (ПоступлениеПоНомеруДатеСЧФ.Проведен)
	 |			И (ПОДСТРОКА(ПоступлениеПоНомеруДатеСЧФ.НомерВходящегоДокумента, 1, 100) = ЭКОМ_ДокументыЮЗД.СЧФНомер)
	 |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный КАК СчетФактураПоНомеруСЧФ
	 |		ПО (ЭКОМ_ДокументыЮЗД.СЧФНомер = ПОДСТРОКА(СчетФактураПоНомеруСЧФ.Номер, 1, 100))
	 |			И (СчетФактураПоНомеруСЧФ.Дата МЕЖДУ ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.СЧФДата, ДЕНЬ, -3) И ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.СЧФДата, ДЕНЬ, 3))
	 |			И ЭКОМ_ДокументыЮЗД.Контрагент = СчетФактураПоНомеруСЧФ.Контрагент
	 |			И ЭКОМ_ДокументыЮЗД.Организация = СчетФактураПоНомеруСЧФ.Организация
	 |			И (НЕ СчетФактураПоНомеруСЧФ.ПометкаУдаления)
	 |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК ЗаказПоставщикаПоНомеруДатеЗаказа
	 |			ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПоступлениеПоЗаказу
	 |			ПО ЗаказПоставщикаПоНомеруДатеЗаказа.Ссылка = ПоступлениеПоЗаказу.ЗаказПоставщику
	 |				И (НЕ ПоступлениеПоЗаказу.ПометкаУдаления)
	 |				И (ПоступлениеПоЗаказу.Проведен)
	 |		ПО ЭКОМ_ДокументыЮЗД.ЗаказНомер = ЗаказПоставщикаПоНомеруДатеЗаказа.Номер
	 |			И (ЗаказПоставщикаПоНомеруДатеЗаказа.Дата МЕЖДУ ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.СЧФДата, ДЕНЬ, -3) И ДОБАВИТЬКДАТЕ(ЭКОМ_ДокументыЮЗД.СЧФДата, ДЕНЬ, 3))
	 |ГДЕ
	 |	ЭКОМ_ДокументыЮЗД.Ссылка = &amp;Приемник
	 |;
	 |
	 |////////////////////////////////////////////////////////////////////////////////
	 |ВЫБРАТЬ РАЗЛИЧНЫЕ
	 |	ВТ.ПН КАК ПН,
	 |	ЕСТЬNULL(СчетФактураПолученныйДокументыОснования.Ссылка, ВТ.СЧФ) КАК СЧФ
	 |ИЗ
	 |	ВТ КАК ВТ
	 |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный.ДокументыОснования КАК СчетФактураПолученныйДокументыОснования
	 |		ПО ВТ.ПН = СчетФактураПолученныйДокументыОснования.ДокументОснование";
	 Запрос.УстановитьПараметр("Приемник", Приемник.Ссылка);
	 
	 Результат = Запрос.Выполнить();                  
	 Если НЕ Результат.Пустой() Тогда
		 Выборка = Результат.Выбрать();    
		 Выборка.Следующий();
		 
		 Если ЗначениеЗаполнено(Выборка.ПН) Тогда
			 НайденоПоступление = Истина;
			 ДокПН  = Выборка.ПН;
			 ПредставлениеДокПоступления1С = "Поступления 1С № " + СокрЛП(ДокПН.Номер) + " от " + Формат(ДокПН.Дата, "ДФ=dd.MM.yyyy");
		 КонецЕсли;
		 
		 Если ЗначениеЗаполнено(Выборка.СЧФ) Тогда
			 НайденаСчетФактура = Истина;
			 ДокСчФ = Выборка.СЧФ;
			 ПредставлениеДокСчФ1С = "Счет-фактура 1С № " + СокрЛП(ДокСчФ.Номер) + " от " + Формат(ДокСчФ.Дата, "ДФ=dd.MM.yyyy");
		 КонецЕсли;
		 
	 КонецЕсли;
	 
	 // Сравниваем данные
	 Если НайденоПоступление = Истина Тогда 
		 // Сравниваем суммы из XML(ЭКОМ док) и документа поступления 1С      
		 РасхождениеПоСумме_с_НДС = (ДокПН.СуммаДокумента - Приемник.СуммаДокументаВсего);
		 РасхождениеПоСумме_с_НДС = ?(РасхождениеПоСумме_с_НДС &gt; 0   , РасхождениеПоСумме_с_НДС, - РасхождениеПоСумме_с_НДС);
		 ЕстьРасхождениеПоСумме_с_НДС = ?(РасхождениеПоСумме_с_НДС &gt; 0.05, Истина, Ложь);
		 
		 ЭКОМСуммаБезНДС = 0;
		 ЭКОМСуммаНДС    = 0;
		 Для каждого Стр Из Приемник.ТЧ_Товары Цикл
			 ЭКОМСуммаБезНДС = ЭКОМСуммаБезНДС + Стр.Сумма;
			 ЭКОМСуммаНДС    = ЭКОМСуммаНДС    + Стр.СуммаНДС;
		 КонецЦикла;
		 
		 СуммаНДСДокумента = 0;
		 Для каждого Стр Из ДокПН.Товары Цикл
			 СуммаНДСДокумента = СуммаНДСДокумента + Стр.СуммаНДС;
		 КонецЦикла;
		 
		 РасхождениеПоСуммеНДС = (СуммаНДСДокумента - ЭКОМСуммаНДС);
		 РасхождениеПоСуммеНДС = ?(РасхождениеПоСуммеНДС &gt; 0   , РасхождениеПоСуммеНДС, - РасхождениеПоСуммеНДС);
		 ЕстьРасхождениеПоСуммеНДС = ?(РасхождениеПоСуммеНДС &gt; 0.05, Истина, Ложь);
		 
		 СуммаБезНДС = ДокПН.СуммаДокумента - СуммаНДСДокумента;
		 РасхождениеПоСуммеБезНДС = (СуммаБезНДС - ЭКОМСуммаБезНДС);
		 РасхождениеПоСуммеБезНДС = ?(РасхождениеПоСуммеБезНДС &gt; 0, РасхождениеПоСуммеБезНДС, - РасхождениеПоСуммеБезНДС);
		 ЕстьРасхождениеПоСуммеБезНДС = ?(РасхождениеПоСуммеБезНДС &gt; 0.05, Истина, Ложь);
		 
		 Если ЕстьРасхождениеПоСумме_с_НДС 
			 ИЛИ ЕстьРасхождениеПоСуммеНДС 
			 ИЛИ ЕстьРасхождениеПоСуммеБезНДС Тогда  
			 ТекстУточнения = "Проверьте суммы документов: " + 
			 "Сумма Всего 1С " + ПредставлениеДокПоступления1С + " = " + ДокПН.СуммаДокумента + "; "
			 "Сумма Всего УПД = " + Приемник.СуммаДокументаВсего + "; " +
			 "Сумма без НДС 1С = " + СуммаБезНДС + "; " +
			 "Сумма без НДС УПД =  " + ЭКОМСуммаБезНДС + "; " + 
			 "Сумма НДС 1С = " + СуммаНДСДокумента + "; " +
			 "Сумма НДС УПД =  " + ЭКОМСуммаНДС;
			 ЛогСобытий = ЛогСобытий + Символы.ПС + ТекстУточнения;
		 КонецЕсли;

		 // построчная проверка количества и суммы
		 ТекстРасхождений = "";
		 ЗапросПострочный = Новый Запрос;
		 ЗапросПострочный.Текст = "ВЫБРАТЬ
		 |	ПоступлениеТоваровУслугТовары.Номенклатура КАК Номенклатура,
		 |	СУММА(ПоступлениеТоваровУслугТовары.Количество) КАК Количество,
		 |	СУММА(ПоступлениеТоваровУслугТовары.СуммаСНДС) КАК Сумма
		 |ПОМЕСТИТЬ ВТ_ПоступлениеТУ
		 |ИЗ
		 |	Документ.ПриобретениеТоваровУслуг.Товары КАК ПоступлениеТоваровУслугТовары
		 |ГДЕ
		 |	ПоступлениеТоваровУслугТовары.Ссылка = &amp;ПоступлениеТоваровУслуг
		 |
		 |СГРУППИРОВАТЬ ПО
		 |	ПоступлениеТоваровУслугТовары.Номенклатура
		 |;
		 |
		 |////////////////////////////////////////////////////////////////////////////////
		 |ВЫБРАТЬ
		 |	ШтрихкодыНоменклатуры.Номенклатура КАК Номенклатура,
		 |	СУММА(ЭКОМ_ДокументыТЧ_Товары.КоличествоПоставляемое) КАК КоличествоПоставляемое,
		 |	СУММА(ЭКОМ_ДокументыТЧ_Товары.Сумма_с_НДС) КАК Сумма
		 |ПОМЕСТИТЬ ВТ_ЭкомДокумент
		 |ИЗ
		 |	Документ.ЭКОМ_Документы.ТЧ_Товары КАК ЭКОМ_ДокументыТЧ_Товары
		 |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
		 |		ПО (ШтрихкодыНоменклатуры.Штрихкод = ЭКОМ_ДокументыТЧ_Товары.НомерПродуктаПокупателя)
		 |ГДЕ
		 |	ЭКОМ_ДокументыТЧ_Товары.Ссылка = &amp;ЭкомДокумент
		 |
		 |СГРУППИРОВАТЬ ПО
		 |	ШтрихкодыНоменклатуры.Номенклатура
		 |;
		 |
		 |////////////////////////////////////////////////////////////////////////////////
		 |ВЫБРАТЬ
		 |	ЕСТЬNULL(ВТ_ПоступлениеТУ.Номенклатура, ВТ_ЭкомДокумент.Номенклатура) КАК Номенклатура,
		 |	ЕСТЬNULL(ВТ_ПоступлениеТУ.Номенклатура.Представление, ВТ_ЭкомДокумент.Номенклатура.Представление) КАК НоменклатураПредставление,
		 |	ЕСТЬNULL(ВТ_ПоступлениеТУ.Количество, 0) КАК ПоступлениеКоличество,
		 |	ЕСТЬNULL(ВТ_ПоступлениеТУ.Сумма, 0) КАК ПоступлениеСумма,
		 |	ЕСТЬNULL(ВТ_ЭкомДокумент.КоличествоПоставляемое, 0) КАК ЭкомДокументКоличество,
		 |	ЕСТЬNULL(ВТ_ЭкомДокумент.Сумма, 0) КАК ЭкомДокументСумма
		 |ИЗ
		 |	ВТ_ПоступлениеТУ КАК ВТ_ПоступлениеТУ
		 |		ПОЛНОЕ СОЕДИНЕНИЕ ВТ_ЭкомДокумент КАК ВТ_ЭкомДокумент
		 |		ПО ВТ_ПоступлениеТУ.Номенклатура = ВТ_ЭкомДокумент.Номенклатура";
		 
		 ЗапросПострочный.УстановитьПараметр("ПоступлениеТоваровУслуг", ДокПН);
		 ЗапросПострочный.УстановитьПараметр("ЭкомДокумент", Приемник.Ссылка);
		 РезультатЗапросаПострочный = ЗапросПострочный.Выполнить();
		 Если Не РезультатЗапросаПострочный.Пустой() Тогда
			 ВыборкаПострочный = РезультатЗапросаПострочный.Выбрать();
			 Пока ВыборкаПострочный.Следующий() Цикл
			 	 СуммаРасхожденияПострочно = ВыборкаПострочный.ПоступлениеСумма - ВыборкаПострочный.ЭкомДокументСумма;
				 СуммаРасхожденияПострочно = ?(СуммаРасхожденияПострочно &gt; 0, СуммаРасхожденияПострочно, -СуммаРасхожденияПострочно);
				 Если ВыборкаПострочный.ПоступлениеКоличество = ВыборкаПострочный.ЭкомДокументКоличество И
					 СуммаРасхожденияПострочно &lt;= 0.05 Тогда
					 Продолжить;
				 КонецЕсли;
				 
				 ТекстРасхождений = ТекстРасхождений + ?(ЗначениеЗаполнено(ТекстРасхождений), Символы.ПС, "");
				 ТекстРасхождений = ТекстРасхождений + "Номенклатура " + ВыборкаПострочный.НоменклатураПредставление + " ";
				 ДобавитьЗапятую = Ложь;
				 Если ВыборкаПострочный.ПоступлениеКоличество &lt;&gt; ВыборкаПострочный.ЭкомДокументКоличество Тогда
					 ТекстРасхождений = ТекстРасхождений + " Количество 1С = " + ВыборкаПострочный.ПоступлениеКоличество + 
					 	", Количество УПД = " + ВыборкаПострочный.ЭкомДокументКоличество;
					 ДобавитьЗапятую = Истина;
				 КонецЕсли;
				 Если СуммаРасхожденияПострочно &gt; 0.05 Тогда
					 ТекстРасхождений = ТекстРасхождений + ?(ДобавитьЗапятую, ", ", "");
					 ТекстРасхождений = ТекстРасхождений + " Cумма 1С = " + ВыборкаПострочный.ПоступлениеСумма + 
					 	 ", Cумма УПД = " + ВыборкаПострочный.ЭкомДокументСумма;
				 КонецЕсли;
				 ТекстРасхождений = ТекстРасхождений + ".";			 
			 КонецЦикла;
			 
			 Если ЗначениеЗаполнено(ТекстРасхождений) Тогда
			 	 ТекстРасхождений = "Проверьте расхождение по количеству/сумме по номенклатуре" + Символы.ПС + ТекстРасхождений;
				 ТекстУточнения = ТекстУточнения + ?(ЗначениеЗаполнено(ТекстУточнения), Символы.ПС, "") + ТекстРасхождений;
				 ЛогСобытий = ЛогСобытий + ?(ЗначениеЗаполнено(ЛогСобытий), Символы.ПС, "") + ТекстРасхождений;
			 КонецЕсли;
		 КонецЕсли;
		 
	 Иначе
		 ЛогСобытий = ЛогСобытий + Символы.ПС + ПредставлениеПН + " по " + ПредставлениеСЧФ + " не найдена";
	 КонецЕсли;	
	 
 Иначе
	 Если ЗначениеЗаполнено(ЭКОМДокОснование) Тогда
		 Если ЭКОМДокОснование.ДокументыСвязанные.Количество() &gt; 0 Тогда
			 ДокПН = ЭКОМДокОснование.ДокументыСвязанные[0].ДокументСвязанный;
			 НайденоПоступление = Истина;
		 КонецЕсли;		 
		 ДокСчФ = ЭКОМДокОснование.Документ1С;
		 НайденаСчетФактура = Истина;
	 КонецЕсли; 
	 
	 Если ЗначениеЗаполнено(ДокПН) Тогда
		 // Поиск корректировки постпуления
		 Запрос = Новый Запрос;
		 Запрос.Текст = 
		 "ВЫБРАТЬ
		 |	КорректировкаПриобретения.Ссылка КАК КоррПН,
		 |	СчетФактураПолученныйДокументыОснования.Ссылка КАК КоррСЧФ
		 |ИЗ
		 |	Документ.КорректировкаПриобретения КАК КорректировкаПриобретения
		 |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный.ДокументыОснования КАК СчетФактураПолученныйДокументыОснования
		 |		ПО КорректировкаПриобретения.Ссылка = СчетФактураПолученныйДокументыОснования.ДокументОснование
		 |ГДЕ
		 |	КорректировкаПриобретения.ДокументОснование = &amp;ДокументОснование";
		 Запрос.УстановитьПараметр("ДокументОснование", ДокПН);
		 
		 Результат = Запрос.Выполнить();                  
		 Если НЕ Результат.Пустой() Тогда
			 Выборка = Результат.Выбрать();    
			 Выборка.Следующий();
			 
			 Если ЗначениеЗаполнено(Выборка.КоррПН) Тогда
				 НайденоПоступление = Истина;
				 КоррПН  = Выборка.КоррПН;
				 ПредставлениеДокКоррПоступления1С = "Корректировка поступления 1С № " + СокрЛП(КоррПН.Номер) + " от " + Формат(КоррПН.Дата, "ДФ=dd.MM.yyyy");
			 КонецЕсли;
			 
			 Если ЗначениеЗаполнено(Выборка.КоррСЧФ) Тогда
				 НайденаСчетФактура = Истина;
				 КоррСЧФ = Выборка.КоррСЧФ;
				 ПредставлениеДокКоррСчФ1С = "Корректировочный счет-фактура 1С № " + СокрЛП(КоррСЧФ.Номер) + " от " + Формат(КоррСЧФ.Дата, "ДФ=dd.MM.yyyy");
			 КонецЕсли;
			 
		 КонецЕсли;
	 КонецЕсли; 
 КонецЕсли;
 
 Если ЗначениеЗаполнено(ТекстУточнения) Тогда
     Приемник.Комментарий = ТекстУточнения;
 КонецЕсли;

 ДокументДляЗаписиПН = ДокПН;
 // Для корректировки
 Если ЗначениеЗаполнено(КоррПН) Тогда      
	 ДокументДляЗаписиПН = КоррПН;
 КонецЕсли;
  
 Если НайденоПоступление = Истина Тогда
     // Если повторная обработка документа необходимо проверить
     Если ТипЗнч(Приемник) = Тип("ДокументСсылка.ЭКОМ_Документы")  Тогда
         Приемник = Приемник.ПолучитьОбъект();
     КонецЕсли;
     Приемник.ДокументыСвязанные.Очистить();
	 Если ЗначениеЗаполнено(ЭКОМДокОснование) Тогда
		 НовСтр = Приемник.ДокументыСвязанные.Добавить();
	     НовСтр.ДокументСвязанный = ЭКОМДокОснование;
	 КонецЕсли;
	 НовСтр = Приемник.ДокументыСвязанные.Добавить(); 
	 НовСтр.ДокументСвязанный = ДокументДляЗаписиПН.Ссылка;
       
     // Создаем счет-фактуру
     Если НайденаСчетФактура = Ложь Тогда
         ПараметрыРегистрации = Документы.ПриобретениеТоваровУслуг.ПараметрыРегистрацииСчетовФактурПолученных(ДокументДляЗаписиПН.Ссылка);
         СчетаФактурыПолученныеНаОсновании = УчетНДСУП.СчетаФактурыПолученныеНаОсновании(ПараметрыРегистрации);         
         Если СчетаФактурыПолученныеНаОсновании.СчетаФактуры.Количество() &gt; 0 Тогда
             ДокСчФ = СчетаФактурыПолученныеНаОсновании.СчетаФактуры[0];
             НайденаСчетФактура = Истина;
         КонецЕсли;

         Если НайденаСчетФактура = Ложь Тогда     
             // Таблица для создания документов СЧФ по собственным данным 
             // (вместо использования данных регистра по результатам запроса DR_События)
             ТаблицаЗначений = Новый ТаблицаЗначений;    
             ТаблицаЗначений.Колонки.Добавить("ИдентификаторЦепочки",Новый ОписаниеТипов("Строка",,,, Новый КвалификаторыСтроки(36)));
             ТаблицаЗначений.Колонки.Добавить("Идентификатор",Новый ОписаниеТипов("Строка",,,, Новый КвалификаторыСтроки(250)));
             ТаблицаЗначений.Колонки.Добавить("Документ" , Новый ОписаниеТипов("ДокументСсылка.ПриобретениеТоваровУслуг"));

             НовСтр = ТаблицаЗначений.Добавить();
             НовСтр.ИдентификаторЦепочки = Приемник.ИдентификаторЦепочки;
             НовСтр.Идентификатор        = ДокументДляЗаписиПН.Ссылка.УникальныйИдентификатор();
             НовСтр.Документ             = ДокументДляЗаписиПН.Ссылка;            
             
             ДокументыИсточники = Новый Массив;
             ДокументыИсточники.Добавить(Новый Структура("ИдентификаторЦепочки, Документ", Приемник.ИдентификаторЦепочки, Приемник.Ссылка));
             

             ТекстЛогаСобытий = "";
             DR_СоздатьДокументПоДинамическойКнопке(ДокументыИсточники, "Создать счет-фактуру полученный", "Покупатель", Ложь, Новый Массив, ТаблицаЗначений);

             СчетаФактурыПолученныеНаОсновании = УчетНДСУП.СчетаФактурыПолученныеНаОсновании(ПараметрыРегистрации);         
             Если СчетаФактурыПолученныеНаОсновании.СчетаФактуры.Количество() &gt; 0 Тогда
                 ДокСчФ = СчетаФактурыПолученныеНаОсновании.СчетаФактуры[0];
                 НайденаСчетФактура = Истина;
             КонецЕсли;        
         КонецЕсли;           
     КонецЕсли;
 КонецЕсли;

 ДокументДляЗаписиСЧФ = ДокСчФ;
 // Для корректировки
 Если ЗначениеЗаполнено(КоррСЧФ) Тогда      
	 ДокументДляЗаписиСЧФ = КоррСЧФ;
 КонецЕсли;

 Если НайденаСчетФактура = Истина Тогда
     ДокСчФОбъект = ДокументДляЗаписиСЧФ.Ссылка.ПолучитьОбъект();
     ДокСчФОбъект.ДатаСоставления  = Приемник.СЧФДата;
     ДокСчФОбъект.Номер            = Приемник.СЧФНомер;
     ДокСчФОбъект.ПолученВЭлектронномВиде = Истина;
     ДокСчФОбъект.Записать();      
     // Если повторная обработка документа необходимо проверить
     Если ТипЗнч(Приемник) = Тип("ДокументСсылка.ЭКОМ_Документы")  Тогда
         Приемник = Приемник.ПолучитьОбъект();
     КонецЕсли;
     Приемник.Документ1С = ДокументДляЗаписиСЧФ.Ссылка;
 КонецЕсли;

 // Если документы найдены, значит документ обработан, проводим документ
 Если НайденаСчетФактура = Истина 
     И НайденоПоступление = Истина Тогда      
     Приемник.Записать(); 
 КонецЕсли;</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">ЮЗД (УПД / УКД / иУПД)</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">4</lastId>
			<item>
				<value xsi:type="xs:string">Прайс-лист</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЭТРН</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>ЮЗД (УПД / УКД / иУПД)</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
		</Value>
	</row>
</ValueTree>