<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Источник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Приемник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Формула</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КолонкаИсточника</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Создать документ установки цен</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string">УстановкаЦенНоменклатуры_Входящий</Value>
		<Value xsi:type="xs:string">ИмяСобытия = "Создание документов по кнопке &lt;&lt;&lt; Создать документ установка цен на основании DR_Документа &gt;&gt;&gt;";
	// служебные переменные гибких настроек ++
	ТипПриемника   = "УстановкаЦенНоменклатуры";
	ОперацияЗапись = Ложь;
	ЛогСобытий = ""; 
	// служебные переменные гибких настроек --
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	ВыбранныеЗаписи.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
	|	ВыбранныеЗаписи.Документ КАК Документ,
	|	ВыбранныеЗаписи.Идентификатор КАК Идентификатор
	|ПОМЕСТИТЬ ВыбранныеЗаписи
	|ИЗ
	|	&amp;ТаблицаВыбранныхЗаписей КАК ВыбранныеЗаписи
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВыбранныеЗаписи.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
	|	ВыбранныеЗаписи.Документ КАК Источник,
	|	ВыбранныеЗаписи.Идентификатор КАК Идентификатор
	|ИЗ
	|	ВыбранныеЗаписи КАК ВыбранныеЗаписи
	|
	|СГРУППИРОВАТЬ ПО
	|	ВыбранныеЗаписи.Документ,
	|	ВыбранныеЗаписи.ИдентификаторЦепочки,
	|	ВыбранныеЗаписи.Идентификатор";
	Запрос.УстановитьПараметр("ТаблицаВыбранныхЗаписей", ТаблицаВыбранныхЗаписей);     
	Выборка = Запрос.Выполнить().Выбрать(); 
	
	Пока Выборка.Следующий() Цикл
		Источник = Выборка.Источник;
		
		
		
		СсылкаНового = Неопределено;
		// Берем ранее созданный документ
		Если ЗначениеЗаполнено(Источник.Документ1С) Тогда
			Приемник = Источник.Документ1С.ПолучитьОбъект();
			ТекстЛогаСобытий = "Перезаписан уже существующий документ для " + Строка(Источник.Ссылка);
			ЗаписатьЛогСобытий(ЛогСобытий, ТекстЛогаСобытий);
		Иначе
			Приемник = Документы[ТипПриемника].СоздатьДокумент();
			СсылкаНового = Документы[ТипПриемника].ПолучитьСсылку(Новый УникальныйИдентификатор); 
			Приемник.УстановитьСсылкуНового(СсылкаНового);
		КонецЕсли;
		
		ИмяДокументаПрименика = "Установка цен номенклатуры 1С";
		
		ИмяТипЦен = "Цена поступления"; 
		МетаданныеТипыЦенНоменклатуры = Метаданные.Справочники.Найти("ТипыЦенНоменклатуры");
		Если МетаданныеТипыЦенНоменклатуры = Неопределено Тогда
			ТипЦен = Справочники.ВидыЦен.НайтиПоНаименованию(ИмяТипЦен);
		Иначе	
			ТипЦен = Справочники.ТипыЦенНоменклатуры.НайтиПоНаименованию(ИмяТипЦен);	
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ТипЦен) Тогда
			Приемник.Дата = ТекущаяДата();
			ЦенаВключаетНДС = Ложь;
			МетаданныеТипЦен = Приемник.Метаданные().Реквизиты.Найти("ТипЦен");
			Если НЕ МетаданныеТипЦен = Неопределено Тогда
				Приемник.ТипЦен = ТипЦен;
				МетаданныеЦенаВключаетНДС = ТипЦен.Метаданные().Реквизиты.Найти("ЦенаВключаетНДС");
				Если НЕ МетаданныеЦенаВключаетНДС = Неопределено Тогда
					ЦенаВключаетНДС = ТипЦен.ЦенаВключаетНДС;
				КонецЕсли; 		
			КонецЕсли;
			
			МетаданныеТипЦенТабличнаяЧасть = Приемник.Метаданные().ТабличныеЧасти.Найти("ТипыЦен");
			Если НЕ МетаданныеТипЦенТабличнаяЧасть = Неопределено Тогда
				Приемник.ТипыЦен.Очистить();
				
				НовСтр = Приемник.ТипыЦен.Добавить();
				НовСтр.ТипЦен = ТипЦен;
			КонецЕсли;
			
			МетаданныеВидыЦеныТабличнаяЧасть = Приемник.Метаданные().ТабличныеЧасти.Найти("ВидыЦен");
			Если НЕ МетаданныеВидыЦеныТабличнаяЧасть = Неопределено Тогда
				Приемник.ВидыЦен.Очистить();
				
				НовСтр = Приемник.ВидыЦен.Добавить();
				НовСтр.ВидЦены = ТипЦен;
			КонецЕсли;
			
			Приемник.Товары.Очистить();
			
			СтруктураТаблицы = Новый Структура;
			СтруктураТаблицы.Вставить("Валюта"         , Ложь);
			СтруктураТаблицы.Вставить("ВидЦены"         , Ложь);
			СтруктураТаблицы.Вставить("ТипЦен"          , Ложь);
			СтруктураТаблицы.Вставить("ЕдиницаИзмерения", Ложь);
			Для каждого ЭлементСтруктуры Из СтруктураТаблицы Цикл
				РеквизитТаблицы = Приемник.Метаданные().ТабличныеЧасти.Товары.Реквизиты.Найти(ЭлементСтруктуры.Ключ);
				Если НЕ РеквизитТаблицы = Неопределено Тогда
					СтруктураТаблицы[ЭлементСтруктуры.Ключ] = Истина;
				КонецЕсли;
			КонецЦикла;
			
			ЗаписатьДокумент = Истина;
			Для каждого Стр Из Источник.ПрайсЛист Цикл
				Если ЗначениеЗаполнено(Стр.Номенклатура) Тогда
					НовСтр = Приемник.Товары.Добавить();
					НовСтр.Номенклатура = Стр.Номенклатура;
					Если ЦенаВключаетНДС Тогда
						НовСтр.Цена = Стр.ЦенаВключаяНДС;
					Иначе	
						НовСтр.Цена = Стр.ЦенаБезНДС;
					КонецЕсли;
					
					Для каждого ЭлементСтруктуры Из СтруктураТаблицы Цикл
						Если ЭлементСтруктуры.Значение = Истина Тогда
							ЗначениеСтроки = Неопределено;
							Если ЭлементСтруктуры.Ключ = "ТипЦен" Тогда
								ЗначениеСтроки = ТипЦен;
								
							ИначеЕсли ЭлементСтруктуры.Ключ = "ЕдиницаИзмерения" Тогда	
								ЗначениеСтроки = НовСтр.Номенклатура.ЕдиницаХраненияОстатков;
								
							ИначеЕсли ЭлементСтруктуры.Ключ = "ВидЦены" Тогда	
								ЗначениеСтроки = ТипЦен;
								
							ИначеЕсли ЭлементСтруктуры.Ключ = "Валюта" Тогда	
								ЗначениеСтроки = Источник.Валюта;
								
							КонецЕсли;
							НовСтр[ЭлементСтруктуры.Ключ] = ЗначениеСтроки;
						КонецЕсли;			
					КонецЦикла;
					
				Иначе
					ТекстЛогаСобытий = "Номенклатура не заполнена. " + Стр.ПолноеНазваниеПродукта + " - " + Стр.ШтрихКодПродукта
					+ ". " + ИмяДокументаПрименика + " по документу " + Строка(Источник.Ссылка) + " не создана."; 
					ЗаписатьЛогСобытий(ЛогСобытий, ТекстЛогаСобытий);
					ЗаписатьДокумент = Ложь;
				КонецЕсли;		
			КонецЦикла;
			
			Если ЗаписатьДокумент = Истина Тогда
			
				Если ЗначениеЗаполнено(Приемник.Ссылка) Тогда
					
					ИсточникОбъект = Источник.ПолучитьОбъект();
					ИсточникОбъект.Документ1С = Приемник.Ссылка;
					ИсточникОбъект.Записать();
					
				ИначеЕсли ЗначениеЗаполнено(СсылкаНового) Тогда
				
					ИсточникОбъект = Источник.ПолучитьОбъект();
					ИсточникОбъект.Документ1С = СсылкаНового;
					ИсточникОбъект.Записать();

				КонецЕсли; 
				  
				Попытка
					Приемник.Записать(РежимЗаписиДокумента.Проведение);
				Исключение
					Приемник.Записать(РежимЗаписиДокумента.Запись);
					ТекстЛогаСобытий = ИмяДокументаПрименика + " по документу " + Строка(Источник.Ссылка) + " не создана!!! " + СокрЛП(ОписаниеОшибки()); 
					ЗаписатьЛогСобытий(ЛогСобытий, ТекстЛогаСобытий);
				КонецПопытки;
				   	
			КонецЕсли;	
		Иначе
			ТекстЛогаСобытий = "Не найден тип/вид цен - " + ИмяТипЦен + ", " + ИмяДокументаПрименика + " по документу " + Строка(Источник.Ссылка) + " не создана."; 
			ЗаписатьЛогСобытий(ЛогСобытий, ТекстЛогаСобытий);
			
		КонецЕсли;
		
		
	КонецЦикла;
</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">PRICAT_Входящий</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">4</lastId>
			<item>
				<value xsi:type="xs:string">Прайс-лист</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЭТРН</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>Создать документ установки цен</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
		</Value>
	</row>
</ValueTree>